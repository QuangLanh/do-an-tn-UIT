# ğŸ” Há»‡ Thá»‘ng PhÃ¢n Quyá»n Chi Tiáº¿t

## ğŸ“‹ Tá»•ng Quan

Há»‡ thá»‘ng Quáº£n LÃ½ Táº¡p HÃ³a sá»­ dá»¥ng **Role-Based Access Control (RBAC)** vá»›i **4 vai trÃ²** ngÆ°á»i dÃ¹ng chÃ­nh.

---

## ğŸ§‘â€ğŸ’¼ CÃ¡c Vai TrÃ²

### 1ï¸âƒ£ Admin (Quáº£n Trá»‹ ViÃªn)
**Quyá»n cao nháº¥t - ToÃ n quyá»n há»‡ thá»‘ng**

#### Quyá»n Háº¡n:
- âœ… **Quáº£n lÃ½ ngÆ°á»i dÃ¹ng**: Táº¡o, xem, sá»­a, xÃ³a ngÆ°á»i dÃ¹ng
- âœ… **PhÃ¢n quyá»n**: GÃ¡n vÃ  thay Ä‘á»•i vai trÃ² ngÆ°á»i dÃ¹ng
- âœ… **Sáº£n pháº©m**: CRUD Ä‘áº§y Ä‘á»§
- âœ… **ÄÆ¡n hÃ ng**: CRUD Ä‘áº§y Ä‘á»§, xem táº¥t cáº£ Ä‘Æ¡n hÃ ng
- âœ… **Nháº­p hÃ ng**: CRUD Ä‘áº§y Ä‘á»§
- âœ… **BÃ¡o cÃ¡o**: Xem vÃ  xuáº¥t táº¥t cáº£ bÃ¡o cÃ¡o
- âœ… **Dashboard**: Truy cáº­p Ä‘áº§y Ä‘á»§
- âœ… **Giao dá»‹ch**: Xem vÃ  quáº£n lÃ½ táº¥t cáº£ giao dá»‹ch

#### Háº¡n Cháº¿:
- KhÃ´ng cÃ³ háº¡n cháº¿

---

### 2ï¸âƒ£ Staff (NhÃ¢n ViÃªn BÃ¡n HÃ ng)
**Quyá»n bÃ¡n hÃ ng cÆ¡ báº£n**

#### Quyá»n Háº¡n:
- âœ… **Táº¡o Ä‘Æ¡n hÃ ng**: Táº¡o Ä‘Æ¡n hÃ ng má»›i
- âœ… **Xem sáº£n pháº©m**: Xem danh sÃ¡ch vÃ  chi tiáº¿t sáº£n pháº©m
- âœ… **In hÃ³a Ä‘Æ¡n**: Xem vÃ  in hÃ³a Ä‘Æ¡n Ä‘Æ¡n hÃ ng
- âœ… **TÃ­nh toÃ¡n**: TÃ­nh tá»•ng tiá»n, thuáº¿, giáº£m giÃ¡

#### Háº¡n Cháº¿:
- âŒ **KhÃ´ng xem Ä‘Æ¡n hÃ ng**: KhÃ´ng xem danh sÃ¡ch Ä‘Æ¡n hÃ ng cá»§a ngÆ°á»i khÃ¡c
- âŒ **KhÃ´ng chá»‰nh sá»­a**: KhÃ´ng sá»­a/xÃ³a Ä‘Æ¡n hÃ ng
- âŒ **KhÃ´ng xem bÃ¡o cÃ¡o tÃ i chÃ­nh**: KhÃ´ng xem doanh thu, chi phÃ­, lá»£i nhuáº­n
- âŒ **KhÃ´ng quáº£n lÃ½ sáº£n pháº©m**: KhÃ´ng táº¡o/sá»­a/xÃ³a sáº£n pháº©m
- âŒ **KhÃ´ng nháº­p hÃ ng**: KhÃ´ng táº¡o phiáº¿u nháº­p
- âŒ **KhÃ´ng quáº£n lÃ½ ngÆ°á»i dÃ¹ng**

---

### 3ï¸âƒ£ Manager (Quáº£n LÃ½ Cá»­a HÃ ng)
**Quyá»n quáº£n lÃ½ vÃ  giÃ¡m sÃ¡t**

#### Quyá»n Háº¡n:
- âœ… **Xem Ä‘Æ¡n hÃ ng**: Xem vÃ  duyá»‡t Ä‘Æ¡n hÃ ng
- âœ… **Quáº£n lÃ½ sáº£n pháº©m**: Táº¡o, sá»­a sáº£n pháº©m (khÃ´ng xÃ³a)
- âœ… **Nháº­p hÃ ng**: Táº¡o phiáº¿u nháº­p kho
- âœ… **Theo dÃµi tá»“n kho**: Xem tá»“n kho vÃ  cáº£nh bÃ¡o
- âœ… **BÃ¡o cÃ¡o**: Xem bÃ¡o cÃ¡o doanh thu, chi phÃ­, lá»£i nhuáº­n
- âœ… **Dashboard**: Truy cáº­p Ä‘áº§y Ä‘á»§ dashboard
- âœ… **Xem ngÆ°á»i dÃ¹ng**: Xem danh sÃ¡ch ngÆ°á»i dÃ¹ng

#### Háº¡n Cháº¿:
- âŒ **KhÃ´ng xÃ³a Ä‘Æ¡n hÃ ng**: Chá»‰ xem vÃ  duyá»‡t
- âŒ **KhÃ´ng xÃ³a sáº£n pháº©m**: KhÃ´ng thá»ƒ xÃ³a sáº£n pháº©m
- âŒ **KhÃ´ng quáº£n lÃ½ ngÆ°á»i dÃ¹ng**: KhÃ´ng táº¡o/sá»­a/xÃ³a ngÆ°á»i dÃ¹ng
- âŒ **KhÃ´ng phÃ¢n quyá»n**: KhÃ´ng thá»ƒ gÃ¡n vai trÃ²
- âŒ **KhÃ´ng xuáº¥t PDF**: Chá»‰ xem bÃ¡o cÃ¡o, khÃ´ng xuáº¥t file

---

### 4ï¸âƒ£ Accountant (Káº¿ ToÃ¡n)
**Quyá»n chá»‰ Ä‘á»c tÃ i chÃ­nh**

#### Quyá»n Háº¡n:
- âœ… **Xem bÃ¡o cÃ¡o**: Xem doanh thu, chi phÃ­, lá»£i nhuáº­n
- âœ… **Xem giao dá»‹ch**: Xem lá»‹ch sá»­ giao dá»‹ch
- âœ… **Xuáº¥t bÃ¡o cÃ¡o**: Xuáº¥t PDF/Excel
- âœ… **Xem Ä‘Æ¡n hÃ ng**: Xem danh sÃ¡ch Ä‘Æ¡n hÃ ng
- âœ… **Xem nháº­p hÃ ng**: Xem phiáº¿u nháº­p kho
- âœ… **Dashboard**: Xem dashboard tá»•ng quan

#### Háº¡n Cháº¿:
- âŒ **KhÃ´ng CRUD**: KhÃ´ng táº¡o/sá»­a/xÃ³a báº¥t ká»³ dá»¯ liá»‡u nÃ o
- âŒ **Chá»‰ Ä‘á»c**: Chá»‰ xem vÃ  xuáº¥t bÃ¡o cÃ¡o
- âŒ **KhÃ´ng quáº£n lÃ½**: KhÃ´ng thá»ƒ quáº£n lÃ½ sáº£n pháº©m, Ä‘Æ¡n hÃ ng, nháº­p hÃ ng

---

## ğŸ“Š Báº£ng PhÃ¢n Quyá»n Chi Tiáº¿t

| Module | Endpoint | Method | Admin | Staff | Manager | Accountant |
|--------|----------|--------|-------|-------|---------|------------|
| **Auth** |
| | `/api/auth/register` | POST | âœ… | âŒ | âŒ | âŒ |
| | `/api/auth/login` | POST | âœ… | âœ… | âœ… | âœ… |
| | `/api/auth/profile` | GET | âœ… | âœ… | âœ… | âœ… |
| **Users** |
| | `/api/users` | GET | âœ… | âŒ | âœ… | âŒ |
| | `/api/users/:id` | GET | âœ… | âŒ | âŒ | âŒ |
| | `/api/users` | POST | âœ… | âŒ | âŒ | âŒ |
| | `/api/users/:id` | PATCH | âœ… | âŒ | âŒ | âŒ |
| | `/api/users/:id` | DELETE | âœ… | âŒ | âŒ | âŒ |
| **Products** |
| | `/api/products` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/products/:id` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/products` | POST | âœ… | âŒ | âœ… | âŒ |
| | `/api/products/:id` | PATCH | âœ… | âŒ | âœ… | âŒ |
| | `/api/products/:id/stock` | PATCH | âœ… | âŒ | âœ… | âŒ |
| | `/api/products/:id` | DELETE | âœ… | âŒ | âŒ | âŒ |
| | `/api/products/low-stock` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/products/categories` | GET | âœ… | âœ… | âœ… | âœ… |
| **Orders** |
| | `/api/orders` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/orders/:id` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/orders` | POST | âœ… | âœ… | âŒ | âŒ |
| | `/api/orders/:id/status` | PATCH | âœ… | âŒ | âŒ | âŒ |
| | `/api/orders/:id` | DELETE | âœ… | âŒ | âŒ | âŒ |
| | `/api/orders/:id/invoice` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/orders/statistics` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/orders/top-products` | GET | âœ… | âœ… | âœ… | âœ… |
| **Purchases** |
| | `/api/purchases` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/purchases/:id` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/purchases` | POST | âœ… | âŒ | âœ… | âŒ |
| | `/api/purchases/:id` | PATCH | âœ… | âŒ | âŒ | âŒ |
| | `/api/purchases/:id` | DELETE | âœ… | âŒ | âŒ | âŒ |
| | `/api/purchases/statistics` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/purchases/suppliers` | GET | âœ… | âœ… | âœ… | âœ… |
| | `/api/purchases/recommendations` | GET | âœ… | âŒ | âœ… | âŒ |
| | `/api/purchases/recommendations/high-priority` | GET | âœ… | âŒ | âœ… | âŒ |
| | `/api/purchases/recommendations/low-priority` | GET | âœ… | âŒ | âœ… | âŒ |
| **Transactions** |
| | `/api/transactions/summary` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/transactions/monthly` | GET | âœ… | âŒ | âœ… | âœ… |
| **Reports** |
| | `/api/reports/summary` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/reports/revenue` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/reports/profit` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/reports/export` | GET | âœ… | âŒ | âŒ | âœ… |
| | `/api/reports/inventory` | GET | âœ… | âŒ | âœ… | âœ… |
| **Dashboard** |
| | `/api/dashboard/summary` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/dashboard/overview` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/dashboard/top-products` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/dashboard/orders-trend` | GET | âœ… | âŒ | âœ… | âœ… |
| | `/api/dashboard/recent-activity` | GET | âœ… | âŒ | âœ… | âœ… |

---

## ğŸ”’ Implementation Details

### Backend (NestJS)

#### Guards vÃ  Decorators:
```typescript
// Sá»­ dá»¥ng @Roles decorator Ä‘á»ƒ báº£o vá»‡ routes
@Roles(UserRole.ADMIN, UserRole.MANAGER)
@UseGuards(JwtAuthGuard, RolesGuard)
@Get('products')
findAll() { ... }
```

#### Default Role:
- Khi Ä‘Äƒng kÃ½ qua API (bá»Ÿi Admin), role máº·c Ä‘á»‹nh: `STAFF`

### Frontend (React)

#### Permission Checking:
```typescript
// Sá»­ dá»¥ng authStore Ä‘á»ƒ kiá»ƒm tra quyá»n
const { hasPermission } = useAuthStore()

if (hasPermission('create_order')) {
  // Hiá»ƒn thá»‹ nÃºt táº¡o Ä‘Æ¡n hÃ ng
}
```

#### Available Permissions:
- `create_product` - Táº¡o sáº£n pháº©m
- `edit_product` - Sá»­a sáº£n pháº©m
- `delete_product` - XÃ³a sáº£n pháº©m
- `create_order` - Táº¡o Ä‘Æ¡n hÃ ng
- `create_purchase` - Táº¡o phiáº¿u nháº­p
- `view_orders` - Xem Ä‘Æ¡n hÃ ng
- `view_purchases` - Xem nháº­p hÃ ng
- `view_reports` - Xem bÃ¡o cÃ¡o
- `export_reports` - Xuáº¥t bÃ¡o cÃ¡o
- `manage_users` - Quáº£n lÃ½ ngÆ°á»i dÃ¹ng

---

## ğŸ§ª Test Credentials

Sau khi cháº¡y `yarn seed` hoáº·c `npm run seed`:

| Role | Email | Password | Description |
|------|-------|----------|-------------|
| Admin | `admin@taphoa.com` | `admin123` | Full access |
| Staff | `staff@taphoa.com` | `staff123` | Sales only |
| Manager | `manager@taphoa.com` | `manager123` | Management |
| Accountant | `accountant@taphoa.com` | `accountant123` | Read-only financial |

---

## ğŸ“ Notes

1. **Staff khÃ´ng thá»ƒ xem danh sÃ¡ch orders**: Chá»‰ cÃ³ thá»ƒ táº¡o Ä‘Æ¡n má»›i vÃ  xem invoice cá»§a Ä‘Æ¡n Ä‘Ã£ táº¡o
2. **Manager khÃ´ng thá»ƒ xÃ³a**: Chá»‰ Admin má»›i cÃ³ quyá»n xÃ³a
3. **Accountant chá»‰ Ä‘á»c**: Táº¥t cáº£ endpoints Ä‘á»u lÃ  GET, khÃ´ng cÃ³ POST/PATCH/DELETE
4. **Register chá»‰ Admin**: Chá»‰ Admin má»›i cÃ³ quyá»n táº¡o tÃ i khoáº£n má»›i

---

**Last Updated**: 2024-10-30
**Version**: 1.0.0

